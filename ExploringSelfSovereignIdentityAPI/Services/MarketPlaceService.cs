using ExploringSelfSovereignIdentityAPI.Models.Request;
using ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain;
using ExploringSelfSovereignIdentityAPI.Services.UserDataService;
using MediatR;
using Microsoft.Extensions.Configuration;
using Nethereum.ABI.FunctionEncoding.Attributes;
using Nethereum.Contracts;
using Nethereum.Contracts.ContractHandlers;
using Nethereum.Contracts.DeploymentHandlers;
using Nethereum.Web3;
using Nethereum.Web3.Accounts;
using Org.BouncyCastle.Asn1.Mozilla;
using Org.BouncyCastle.Asn1.Ocsp;
using System;
using System.Collections.Generic;
using System.Numerics;
using System.Threading.Tasks;
using Attribute = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.Attribute;
using IUserDataService = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.IUserDataService;

namespace ExploringSelfSovereignIdentityAPI.Services
{
    public class MarketPlaceService : IMarketPlaceService
    {

        private static string url = "http://testchain.nethereum.com:8545";

        /*private static string privateKey = "0x7580e7fb49df1c861f0050fae31c2224c6aba908e116b8da44ee8cd927b990b0";
        static Web3 web3 = new Web3(new Nethereum.Web3.Accounts.Account(privateKey, 444444444500), url);*/

        private static string privateKey;
        private static Account acc;
        private static Web3 web3;

        private static IConfiguration configuration;

        private static ContractHandler contractHandler;

        private IUserDataService userData;

        public MarketPlaceService(IUserDataService userData, IConfiguration config)
        {
            this.userData = userData;
            configuration = config;
        }

        private async Task<ContractHandler> deploy()
        {
            privateKey = configuration["accPKMarketplace"];
            acc = new Nethereum.Web3.Accounts.Account(privateKey, 444444444500);

            web3 = new Web3(acc, url);
            web3.TransactionManager.UseLegacyAsDefault = true;

            var marketPlaceDeployment = new MarketPlaceDeployment();

            var transactionReceiptDeployment = await web3.Eth.GetContractDeploymentHandler<MarketPlaceDeployment>().SendRequestAndWaitForReceiptAsync(marketPlaceDeployment);
            var contractAddress = transactionReceiptDeployment.ContractAddress;
            
            return web3.Eth.GetContractHandler(contractAddress);
        }

        public async Task<string> addDataPack(AddDataPackRequest2 request)
        {

            if (contractHandler == null) contractHandler = await deploy();

            var addDataPackFunction = new AddDataPackFunction();
            addDataPackFunction.Request = new AddDataPackRequest();
            addDataPackFunction.Request.Id = request.Id;
            addDataPackFunction.Request.PricePerUnit = request.PricePerUnit;
            addDataPackFunction.Request.Organization = request.Organization;
            addDataPackFunction.Request.RequestedAttributes = request.RequestedAttributes;
            var addDataPackFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(addDataPackFunction);

            return "success";
        }

        public async Task<BuyDataOutputDTO2> buyData(BuyDataRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var buyDataFunction = new BuyDataFunction();
            buyDataFunction.Request = request;

            
            BuyDataOutputDTO buyDataFunctionTxnReceipt = await contractHandler.QueryDeserializingToObjectAsync<BuyDataFunction, BuyDataOutputDTO>(buyDataFunction);

            BuyDataOutputDTO2 ret = new BuyDataOutputDTO2();

            if (buyDataFunctionTxnReceipt != null)
            {
                if (buyDataFunctionTxnReceipt.ReturnValue1.Status == "success")
                {
                    //await userData.updateBalance(request.UserID, (int)buyDataFunctionTxnReceipt.ReturnValue1.Amount);
                }

                //buyDataFunction.Request.Attributes.ForEach(attr => Console.WriteLine("Here: " + attr.Name));

                ret.ReturnValue1 = new BuyDataResponse2();
                ret.ReturnValue1.Status = buyDataFunctionTxnReceipt.ReturnValue1.Status;
                ret.ReturnValue1.Amount = (int)buyDataFunctionTxnReceipt.ReturnValue1.Amount;

            }

            return ret;
        }

        public async Task<string> createOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var createOrganizationFunction = new CreateOrganizationFunction();
            createOrganizationFunction.Request = request;
            var createOrganizationFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(createOrganizationFunction);

            return "success";
        }

        public async Task<GetOrganizationOutputDTO2> getOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var getOrganizationFunction = new GetOrganizationFunction();
            getOrganizationFunction.Request = request;
            var getOrganizationOutputDTO = await contractHandler.QueryDeserializingToObjectAsync<GetOrganizationFunction, GetOrganizationOutputDTO>(getOrganizationFunction);

            GetOrganizationOutputDTO2 ret = new GetOrganizationOutputDTO2();
            ret.ReturnValue1 = new OrganizationResponse2();

            ret.ReturnValue1.Id = getOrganizationOutputDTO.ReturnValue1.Id;
            ret.ReturnValue1.Balance = (int) getOrganizationOutputDTO.ReturnValue1.Balance;
            ret.ReturnValue1.Status = getOrganizationOutputDTO.ReturnValue1.Status;

            ret.ReturnValue1.Packs = new List<DataPackResponse2>();

            Console.WriteLine(getOrganizationOutputDTO.ReturnValue1.Packs.Count);

            for (int i=0; i< getOrganizationOutputDTO.ReturnValue1.Packs.Count; i++)
            {
                Console.WriteLine(getOrganizationOutputDTO.ReturnValue1.Packs[i].Received.Count);
                DataPackResponse2 p = new DataPackResponse2();
                p.Id = getOrganizationOutputDTO.ReturnValue1.Packs[i].Id;
                p.PricePerUnit = (int) getOrganizationOutputDTO.ReturnValue1.Packs[i].PricePerUnit;
                p.Received = getOrganizationOutputDTO.ReturnValue1.Packs[i].Received;

                ret.ReturnValue1.Packs.Add(p);
            }

            return ret;
        }

        public async Task<GetAllOrganizationsOutputDTO2> getAllOrganizations(string id)
        {

            var getAllOrganizationsFunction = new GetAllOrganizationsFunction();
            getAllOrganizationsFunction.Id = id;
            var temp = await contractHandler.QueryDeserializingToObjectAsync<GetAllOrganizationsFunction, GetAllOrganizationsOutputDTO>(getAllOrganizationsFunction);

            //var temp = await contractHandler.QueryDeserializingToObjectAsync<GetAllOrganizationsFunction, GetAllOrganizationsOutputDTO>();

            var ret = new GetAllOrganizationsOutputDTO2();
            ret.ReturnValue1 = new List<AllOrganizationResponse2>();

            for (int i=0; i<temp.ReturnValue1.Count; i++)
            {
                Console.WriteLine(temp.ReturnValue1[i].Id);
                Console.WriteLine(temp.ReturnValue1[i].Organization);

                AllOrganizationResponse2 p = new AllOrganizationResponse2();

                p.Id = temp.ReturnValue1[i].Id;
                p.PricePerUnit = (int) temp.ReturnValue1[i].PricePerUnit;
                p.Organization = temp.ReturnValue1[i].Organization;

                p.Attributes = temp.ReturnValue1[i].Attributes;
                
                ret.ReturnValue1.Add(p);
            }

            return ret;
        }
    }

    public partial class MarketPlaceDeployment : MarketPlaceDeploymentBase
    {
        public MarketPlaceDeployment() : base(BYTECODE) { }
        public MarketPlaceDeployment(string byteCode) : base(byteCode) { }
    }

    public class MarketPlaceDeploymentBase : ContractDeploymentMessage
    {
        public static string BYTECODE = "0x608060405234801561001057600080fd5b50612bab806100206000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c806317d104f81461005c57806320b0a34b1461007857806373001f80146100a8578063804a18b8146100d85780638d0f9c6814610108575b600080fd5b61007660048036038101906100719190611f24565b610124565b005b610092600480360381019061008d9190611f6d565b610335565b60405161009f9190612242565b60405180910390f35b6100c260048036038101906100bd91906122ec565b6109c4565b6040516100cf91906126cb565b60405180910390f35b6100f260048036038101906100ed919061293e565b611314565b6040516100ff91906129c4565b60405180910390f35b610122600480360381019061011d91906122ec565b61192e565b005b60006003826000015160405161013a9190612a22565b9081526020016040518091039020600301600081548092919061015c90612a68565b91905055905081602001516003836000015160405161017b9190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060000190805190602001906101b3929190611a76565b508160400151600383600001516040516101cd9190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060010181905550816060015151600383600001516040516102109190612a22565b908152602001604051809103902060040160008381526020019081526020016000206002018190555060006003836000015160405161024f9190612a22565b908152602001604051809103902060040160008381526020019081526020016000206004018190555060005b826060015151811015610318578260600151818151811061029f5761029e612ab1565b5b6020026020010151600384600001516040516102bb9190612a22565b9081526020016040518091039020600401600084815260200190815260200160002060030160008381526020019081526020016000209080519060200190610304929190611a76565b50808061031090612a68565b91505061027b565b506001600081548092919061032c90612a68565b91905055505050565b6060600060015467ffffffffffffffff81111561035557610354611c02565b5b60405190808252806020026020018201604052801561038e57816020015b61037b611afc565b8152602001906001900390816103735790505b509050606060005b6000548110156109b9576002600082815260200190815260200160002080546103be90612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546103ea90612b0f565b80156104375780601f1061040c57610100808354040283529160200191610437565b820191906000526020600020905b81548152906001019060200180831161041a57829003601f168201915b5050505050915060006003836040516104509190612a22565b908152602001604051809103902060030154905060005b818110156109a4576000805b6003866040516104839190612a22565b90815260200160405180910390206004016000848152602001908152602001600020600401548110156105a85761058b6003876040516104c39190612a22565b908152602001604051809103902060040160008581526020019081526020016000206005016000838152602001908152602001600020600001805461050790612b0f565b80601f016020809104026020016040519081016040528092919081815260200182805461053390612b0f565b80156105805780601f1061055557610100808354040283529160200191610580565b820191906000526020600020905b81548152906001019060200180831161056357829003601f168201915b50505050508a611a4a565b1561059557600191505b80806105a090612a68565b915050610473565b5080156105b55750610991565b6003856040516105c59190612a22565b908152602001604051809103902060000180546105e190612b0f565b80601f016020809104026020016040519081016040528092919081815260200182805461060d90612b0f565b801561065a5780601f1061062f5761010080835404028352916020019161065a565b820191906000526020600020905b81548152906001019060200180831161063d57829003601f168201915b505050505086838151811061067257610671612ab1565b5b6020026020010151600001819052506003856040516106919190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060000180546106c190612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546106ed90612b0f565b801561073a5780601f1061070f5761010080835404028352916020019161073a565b820191906000526020600020905b81548152906001019060200180831161071d57829003601f168201915b505050505086838151811061075257610751612ab1565b5b6020026020010151602001819052506003856040516107719190612a22565b90815260200160405180910390206004016000838152602001908152602001600020600101548683815181106107aa576107a9612ab1565b5b6020026020010151604001818152505060006003866040516107cc9190612a22565b908152602001604051809103902060040160008481526020019081526020016000206002015490508067ffffffffffffffff81111561080e5761080d611c02565b5b60405190808252806020026020018201604052801561084157816020015b606081526020019060019003908161082c5790505b5087848151811061085557610854612ab1565b5b60200260200101516060018190525060005b8181101561098d5760038760405161087f9190612a22565b90815260200160405180910390206004016000858152602001908152602001600020600301600082815260200190815260200160002080546108c090612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546108ec90612b0f565b80156109395780601f1061090e57610100808354040283529160200191610939565b820191906000526020600020905b81548152906001019060200180831161091c57829003601f168201915b505050505088858151811061095157610950612ab1565b5b602002602001015160600151828151811061096f5761096e612ab1565b5b6020026020010181905250808061098590612a68565b915050610867565b5050505b808061099c90612a68565b915050610467565b505080806109b190612a68565b915050610396565b508192505050919050565b6109cc611b24565b6109d4611b24565b610a8f8360200151600385600001516040516109f09190612a22565b90815260200160405180910390206001018054610a0c90612b0f565b80601f0160208091040260200160405190810160405280929190818152602001828054610a3890612b0f565b8015610a855780601f10610a5a57610100808354040283529160200191610a85565b820191906000526020600020905b815481529060010190602001808311610a6857829003601f168201915b5050505050611a4a565b610ada576040518060400160405280600681526020017f6661696c6564000000000000000000000000000000000000000000000000000081525081604001819052508091505061130f565b826000015181600001819052506040518060400160405280600781526020017f7375636365737300000000000000000000000000000000000000000000000000815250816040018190525060038360000151604051610b399190612a22565b908152602001604051809103902060020154816020018181525050600060038460000151604051610b6a9190612a22565b90815260200160405180910390206003015490508067ffffffffffffffff811115610b9857610b97611c02565b5b604051908082528060200260200182016040528015610bd157816020015b610bbe611b4c565b815260200190600190039081610bb65790505b50826060018190525060005b818110156113085760038560000151604051610bf99190612a22565b908152602001604051809103902060040160008281526020019081526020016000206000018054610c2990612b0f565b80601f0160208091040260200160405190810160405280929190818152602001828054610c5590612b0f565b8015610ca25780601f10610c7757610100808354040283529160200191610ca2565b820191906000526020600020905b815481529060010190602001808311610c8557829003601f168201915b505050505083606001518281518110610cbe57610cbd612ab1565b5b60200260200101516000018190525060038560000151604051610ce19190612a22565b908152602001604051809103902060040160008281526020019081526020016000206001015483606001518281518110610d1e57610d1d612ab1565b5b6020026020010151602001818152505060038560000151604051610d429190612a22565b908152602001604051809103902060040160008281526020019081526020016000206004015467ffffffffffffffff811115610d8157610d80611c02565b5b604051908082528060200260200182016040528015610dba57816020015b610da7611b6d565b815260200190600190039081610d9f5790505b5083606001518281518110610dd257610dd1612ab1565b5b60200260200101516040018190525060005b60038660000151604051610df89190612a22565b90815260200160405180910390206004016000838152602001908152602001600020600401548110156112f45760038660000151604051610e399190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060050160008281526020019081526020016000206000018054610e7d90612b0f565b80601f0160208091040260200160405190810160405280929190818152602001828054610ea990612b0f565b8015610ef65780601f10610ecb57610100808354040283529160200191610ef6565b820191906000526020600020905b815481529060010190602001808311610ed957829003601f168201915b505050505084606001518381518110610f1257610f11612ab1565b5b6020026020010151604001518281518110610f3057610f2f612ab1565b5b602002602001015160000181905250600060038760000151604051610f559190612a22565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001015490508067ffffffffffffffff811115610fab57610faa611c02565b5b604051908082528060200260200182016040528015610fe457816020015b610fd1611b87565b815260200190600190039081610fc95790505b5085606001518481518110610ffc57610ffb612ab1565b5b602002602001015160400151838151811061101a57611019612ab1565b5b60200260200101516020018190525060005b818110156112df57600388600001516040516110489190612a22565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600082815260200190815260200160002060000180546110a090612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546110cc90612b0f565b80156111195780601f106110ee57610100808354040283529160200191611119565b820191906000526020600020905b8154815290600101906020018083116110fc57829003601f168201915b50505050508660600151858151811061113557611134612ab1565b5b602002602001015160400151848151811061115357611152612ab1565b5b602002602001015160200151828151811061117157611170612ab1565b5b602002602001015160000181905250600388600001516040516111949190612a22565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600082815260200190815260200160002060010180546111ec90612b0f565b80601f016020809104026020016040519081016040528092919081815260200182805461121890612b0f565b80156112655780601f1061123a57610100808354040283529160200191611265565b820191906000526020600020905b81548152906001019060200180831161124857829003601f168201915b50505050508660600151858151811061128157611280612ab1565b5b602002602001015160400151848151811061129f5761129e612ab1565b5b60200260200101516020015182815181106112bd576112bc612ab1565b5b60200260200101516020018190525080806112d790612a68565b91505061102c565b505080806112ec90612a68565b915050610de4565b50808061130090612a68565b915050610bdd565b5081925050505b919050565b61131c611ba1565b611324611ba1565b60005b6003846020015160405161133b9190612a22565b908152602001604051809103902060030154811015611923576114236003856020015160405161136b9190612a22565b90815260200160405180910390206004016000838152602001908152602001600020600001805461139b90612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546113c790612b0f565b80156114145780601f106113e957610100808354040283529160200191611414565b820191906000526020600020905b8154815290600101906020018083116113f757829003601f168201915b50505050508560400151611a4a565b156119105760005b6003856020015160405161143f9190612a22565b90815260200160405180910390206004016000838152602001908152602001600020600401548110156115b05761154f600386602001516040516114839190612a22565b90815260200160405180910390206004016000848152602001908152602001600020600501600083815260200190815260200160002060000180546114c790612b0f565b80601f01602080910402602001604051908101604052809291908181526020018280546114f390612b0f565b80156115405780601f1061151557610100808354040283529160200191611540565b820191906000526020600020905b81548152906001019060200180831161152357829003601f168201915b50505050508660000151611a4a565b1561159d576040518060400160405280600681526020017f6661696c656400000000000000000000000000000000000000000000000000008152508360000181905250829350505050611929565b80806115a890612a68565b91505061142b565b506000600385602001516040516115c79190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060040160008154809291906115fd90612a68565b91905055905084600001516003866020015160405161161c9190612a22565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206000019080519060200190611668929190611a76565b50846060015151600386602001516040516116839190612a22565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001018190555060005b85606001515181101561181357856060015181815181106116e7576116e6612ab1565b5b602002602001015160000151600387602001516040516117079190612a22565b90815260200160405180910390206004016000858152602001908152602001600020600501600084815260200190815260200160002060020160008381526020019081526020016000206000019080519060200190611767929190611a76565b508560600151818151811061177f5761177e612ab1565b5b6020026020010151602001516003876020015160405161179f9190612a22565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600083815260200190815260200160002060010190805190602001906117ff929190611a76565b50808061180b90612a68565b9150506116c3565b506040518060400160405280600781526020017f73756363657373000000000000000000000000000000000000000000000000008152508360000181905250600385602001516040516118669190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060010154836020018181525050600385602001516040516118a99190612a22565b9081526020016040518091039020600401600083815260200190815260200160002060010154600386602001516040516118e39190612a22565b908152602001604051809103902060020160008282546119039190612b41565b9250508190555050611923565b808061191b90612a68565b915050611327565b50809150505b919050565b8060000151600382600001516040516119479190612a22565b9081526020016040518091039020600001908051906020019061196b929190611a76565b508060200151600382600001516040516119859190612a22565b908152602001604051809103902060010190805190602001906119a9929190611a76565b506000600382600001516040516119c09190612a22565b9081526020016040518091039020600301819055506064600382600001516040516119eb9190612a22565b9081526020016040518091039020600201819055506000806000815480929190611a1490612a68565b9190505590508160000151600260008381526020019081526020016000209080519060200190611a45929190611a76565b505050565b6000818051906020012083805190602001201415611a6b5760019050611a70565b600090505b92915050565b828054611a8290612b0f565b90600052602060002090601f016020900481019282611aa45760008555611aeb565b82601f10611abd57805160ff1916838001178555611aeb565b82800160010185558215611aeb579182015b82811115611aea578251825591602001919060010190611acf565b5b509050611af89190611bbb565b5090565b6040518060800160405280606081526020016060815260200160008152602001606081525090565b6040518060800160405280606081526020016000815260200160608152602001606081525090565b60405180606001604052806060815260200160008152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001600081525090565b5b80821115611bd4576000816000905550600101611bbc565b5090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611c3a82611bf1565b810181811067ffffffffffffffff82111715611c5957611c58611c02565b5b80604052505050565b6000611c6c611bd8565b9050611c788282611c31565b919050565b600080fd5b600080fd5b600080fd5b600067ffffffffffffffff821115611ca757611ca6611c02565b5b611cb082611bf1565b9050602081019050919050565b82818337600083830152505050565b6000611cdf611cda84611c8c565b611c62565b905082815260208101848484011115611cfb57611cfa611c87565b5b611d06848285611cbd565b509392505050565b600082601f830112611d2357611d22611c82565b5b8135611d33848260208601611ccc565b91505092915050565b6000819050919050565b611d4f81611d3c565b8114611d5a57600080fd5b50565b600081359050611d6c81611d46565b92915050565b600067ffffffffffffffff821115611d8d57611d8c611c02565b5b602082029050602081019050919050565b600080fd5b6000611db6611db184611d72565b611c62565b90508083825260208201905060208402830185811115611dd957611dd8611d9e565b5b835b81811015611e2057803567ffffffffffffffff811115611dfe57611dfd611c82565b5b808601611e0b8982611d0e565b85526020850194505050602081019050611ddb565b5050509392505050565b600082601f830112611e3f57611e3e611c82565b5b8135611e4f848260208601611da3565b91505092915050565b600060808284031215611e6e57611e6d611bec565b5b611e786080611c62565b9050600082013567ffffffffffffffff811115611e9857611e97611c7d565b5b611ea484828501611d0e565b600083015250602082013567ffffffffffffffff811115611ec857611ec7611c7d565b5b611ed484828501611d0e565b6020830152506040611ee884828501611d5d565b604083015250606082013567ffffffffffffffff811115611f0c57611f0b611c7d565b5b611f1884828501611e2a565b60608301525092915050565b600060208284031215611f3a57611f39611be2565b5b600082013567ffffffffffffffff811115611f5857611f57611be7565b5b611f6484828501611e58565b91505092915050565b600060208284031215611f8357611f82611be2565b5b600082013567ffffffffffffffff811115611fa157611fa0611be7565b5b611fad84828501611d0e565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561201c578082015181840152602081019050612001565b8381111561202b576000848401525b50505050565b600061203c82611fe2565b6120468185611fed565b9350612056818560208601611ffe565b61205f81611bf1565b840191505092915050565b61207381611d3c565b82525050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b60006120b18383612031565b905092915050565b6000602082019050919050565b60006120d182612079565b6120db8185612084565b9350836020820285016120ed85612095565b8060005b85811015612129578484038952815161210a85826120a5565b9450612115836120b9565b925060208a019950506001810190506120f1565b50829750879550505050505092915050565b600060808301600083015184820360008601526121588282612031565b915050602083015184820360208601526121728282612031565b9150506040830151612187604086018261206a565b506060830151848203606086015261219f82826120c6565b9150508091505092915050565b60006121b8838361213b565b905092915050565b6000602082019050919050565b60006121d882611fb6565b6121e28185611fc1565b9350836020820285016121f485611fd2565b8060005b85811015612230578484038952815161221185826121ac565b945061221c836121c0565b925060208a019950506001810190506121f8565b50829750879550505050505092915050565b6000602082019050818103600083015261225c81846121cd565b905092915050565b60006040828403121561227a57612279611bec565b5b6122846040611c62565b9050600082013567ffffffffffffffff8111156122a4576122a3611c7d565b5b6122b084828501611d0e565b600083015250602082013567ffffffffffffffff8111156122d4576122d3611c7d565b5b6122e084828501611d0e565b60208301525092915050565b60006020828403121561230257612301611be2565b5b600082013567ffffffffffffffff8111156123205761231f611be7565b5b61232c84828501612264565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600060408301600083015184820360008601526123d68282612031565b915050602083015184820360208601526123f08282612031565b9150508091505092915050565b600061240983836123b9565b905092915050565b6000602082019050919050565b60006124298261238d565b6124338185612398565b935083602082028501612445856123a9565b8060005b85811015612481578484038952815161246285826123fd565b945061246d83612411565b925060208a01995050600181019050612449565b50829750879550505050505092915050565b600060408301600083015184820360008601526124b08282612031565b915050602083015184820360208601526124ca828261241e565b9150508091505092915050565b60006124e38383612493565b905092915050565b6000602082019050919050565b600061250382612361565b61250d818561236c565b93508360208202850161251f8561237d565b8060005b8581101561255b578484038952815161253c85826124d7565b9450612547836124eb565b925060208a01995050600181019050612523565b50829750879550505050505092915050565b6000606083016000830151848203600086015261258a8282612031565b915050602083015161259f602086018261206a565b50604083015184820360408601526125b782826124f8565b9150508091505092915050565b60006125d0838361256d565b905092915050565b6000602082019050919050565b60006125f082612335565b6125fa8185612340565b93508360208202850161260c85612351565b8060005b85811015612648578484038952815161262985826125c4565b9450612634836125d8565b925060208a01995050600181019050612610565b50829750879550505050505092915050565b600060808301600083015184820360008601526126778282612031565b915050602083015161268c602086018261206a565b50604083015184820360408601526126a48282612031565b915050606083015184820360608601526126be82826125e5565b9150508091505092915050565b600060208201905081810360008301526126e5818461265a565b905092915050565b600067ffffffffffffffff82111561270857612707611c02565b5b602082029050602081019050919050565b60006040828403121561272f5761272e611bec565b5b6127396040611c62565b9050600082013567ffffffffffffffff81111561275957612758611c7d565b5b61276584828501611d0e565b600083015250602082013567ffffffffffffffff81111561278957612788611c7d565b5b61279584828501611d0e565b60208301525092915050565b60006127b46127af846126ed565b611c62565b905080838252602082019050602084028301858111156127d7576127d6611d9e565b5b835b8181101561281e57803567ffffffffffffffff8111156127fc576127fb611c82565b5b8086016128098982612719565b855260208501945050506020810190506127d9565b5050509392505050565b600082601f83011261283d5761283c611c82565b5b813561284d8482602086016127a1565b91505092915050565b60006080828403121561286c5761286b611bec565b5b6128766080611c62565b9050600082013567ffffffffffffffff81111561289657612895611c7d565b5b6128a284828501611d0e565b600083015250602082013567ffffffffffffffff8111156128c6576128c5611c7d565b5b6128d284828501611d0e565b602083015250604082013567ffffffffffffffff8111156128f6576128f5611c7d565b5b61290284828501611d0e565b604083015250606082013567ffffffffffffffff81111561292657612925611c7d565b5b61293284828501612828565b60608301525092915050565b60006020828403121561295457612953611be2565b5b600082013567ffffffffffffffff81111561297257612971611be7565b5b61297e84828501612856565b91505092915050565b600060408301600083015184820360008601526129a48282612031565b91505060208301516129b9602086018261206a565b508091505092915050565b600060208201905081810360008301526129de8184612987565b905092915050565b600081905092915050565b60006129fc82611fe2565b612a0681856129e6565b9350612a16818560208601611ffe565b80840191505092915050565b6000612a2e82846129f1565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000612a7382611d3c565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415612aa657612aa5612a39565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680612b2757607f821691505b60208210811415612b3b57612b3a612ae0565b5b50919050565b6000612b4c82611d3c565b9150612b5783611d3c565b925082821015612b6a57612b69612a39565b5b82820390509291505056fea264697066735822122002b845abdcbc36f3e8d336612f334251a5e53c030a036727e32ae5aa8ac41a3c64736f6c63430008090033";
        public MarketPlaceDeploymentBase() : base(BYTECODE) { }
        public MarketPlaceDeploymentBase(string byteCode) : base(byteCode) { }

    }

    public partial class AddDataPackFunction : AddDataPackFunctionBase { }

    [Function("addDataPack")]
    public class AddDataPackFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual AddDataPackRequest Request { get; set; }
    }

    public partial class BuyDataFunction : BuyDataFunctionBase { }

    [Function("buyData", typeof(BuyDataOutputDTO))]
    public class BuyDataFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual BuyDataRequest Request { get; set; }
    }

    public partial class CreateOrganizationFunction : CreateOrganizationFunctionBase { }

    [Function("createOrganization")]
    public class CreateOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }

    public partial class GetAllOrganizationsFunction : GetAllOrganizationsFunctionBase { }

    [Function("getAllOrganizations", typeof(GetAllOrganizationsOutputDTO))]
    public class GetAllOrganizationsFunctionBase : FunctionMessage
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
    }

    public partial class GetOrganizationFunction : GetOrganizationFunctionBase { }

    [Function("getOrganization", typeof(GetOrganizationOutputDTO))]
    public class GetOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }



    public partial class BuyDataOutputDTO : BuyDataOutputDTOBase { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse ReturnValue1 { get; set; }
    }



    public partial class GetAllOrganizationsOutputDTO : GetAllOrganizationsOutputDTOBase { }

    [FunctionOutput]
    public class GetAllOrganizationsOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple[]", "", 1)]
        public virtual List<AllOrganizationResponse> ReturnValue1 { get; set; }
    }

    public partial class GetOrganizationOutputDTO : GetOrganizationOutputDTOBase { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse ReturnValue1 { get; set; }
    }

    public partial class AddDataPackRequest : AddDataPackRequestBase { }

    public class AddDataPackRequestBase
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse : BuyDataResponseBase { }

    public class BuyDataResponseBase
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual BigInteger Amount { get; set; }
    }

    public partial class BuyDataRequest : BuyDataRequestBase { }

    public class BuyDataRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("string", "organization", 2)]
        public virtual string Organization { get; set; }
        [Parameter("string", "dataPackID", 3)]
        public virtual string DataPackID { get; set; }
        [Parameter("tuple[]", "attributes", 4)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class CreateOrgRequest : CreateOrgRequestBase { }

    public class CreateOrgRequestBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("string", "password", 2)]
        public virtual string Password { get; set; }
    }

    public partial class AllOrganizationResponse : AllOrganizationResponseBase { }

    public class AllOrganizationResponseBase
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("string[]", "attributes", 4)]
        public virtual List<string> Attributes { get; set; }
    }

    public partial class DataPackReceivedRequest : DataPackReceivedRequestBase { }

    public class DataPackReceivedRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("tuple[]", "attributes", 2)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class DataPackResponse : DataPackResponseBase { }

    public class DataPackResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }

    public partial class OrganizationResponse : OrganizationResponseBase { }

    public class OrganizationResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual BigInteger Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse> Packs { get; set; }
    }




    public partial class GetAllOrganizationsOutputDTO2 : GetAllOrganizationsOutputDTOBase2 { }

    [FunctionOutput]
    public class GetAllOrganizationsOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple[]", "", 1)]
        public virtual List<AllOrganizationResponse2> ReturnValue1 { get; set; }
    }

    public partial class AllOrganizationResponse2 : AllOrganizationResponseBase2 { }

    public class AllOrganizationResponseBase2
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("string[]", "attributes", 4)]
        public virtual List<string> Attributes { get; set; }
    }





    public partial class DataPackResponse2 : DataPackResponseBase2 { }

    public class DataPackResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }
    public partial class GetOrganizationOutputDTO2 : GetOrganizationOutputDTOBase2 { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse2 ReturnValue1 { get; set; }
    }

    public partial class OrganizationResponse2 : OrganizationResponseBase2 { }

    public class OrganizationResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual int Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse2> Packs { get; set; }
    }

    public partial class AddDataPackRequest2 : AddDataPackRequestBase2 { }

    public class AddDataPackRequestBase2
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse2 : BuyDataResponseBase2 { }

    public class BuyDataResponseBase2
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual int Amount { get; set; }
    }
    public partial class BuyDataOutputDTO2 : BuyDataOutputDTOBase2 { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse2 ReturnValue1 { get; set; }
    }
}

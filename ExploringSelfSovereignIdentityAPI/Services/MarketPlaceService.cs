using ExploringSelfSovereignIdentityAPI.Models.Request;
using ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain;
using ExploringSelfSovereignIdentityAPI.Services.UserDataService;
using MediatR;
using Microsoft.Extensions.Configuration;
using Nethereum.ABI.FunctionEncoding.Attributes;
using Nethereum.Contracts;
using Nethereum.Contracts.ContractHandlers;
using Nethereum.Contracts.DeploymentHandlers;
using Nethereum.Web3;
using Nethereum.Web3.Accounts;
using Org.BouncyCastle.Asn1.Mozilla;
using Org.BouncyCastle.Asn1.Ocsp;
using System;
using System.Collections.Generic;
using System.Numerics;
using System.Threading.Tasks;
using Attribute = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.Attribute;
using IUserDataService = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.IUserDataService;

namespace ExploringSelfSovereignIdentityAPI.Services
{
    public class MarketPlaceService : IMarketPlaceService
    {

        private static string url = "http://testchain.nethereum.com:8545";

        /*private static string privateKey = "0x7580e7fb49df1c861f0050fae31c2224c6aba908e116b8da44ee8cd927b990b0";
        static Web3 web3 = new Web3(new Nethereum.Web3.Accounts.Account(privateKey, 444444444500), url);*/

        private static string privateKey;
        private static Account acc;
        private static Web3 web3;

        private static IConfiguration configuration;

        private static ContractHandler contractHandler;

        private IUserDataService userData;

        public MarketPlaceService(IUserDataService userData, IConfiguration config)
        {
            this.userData = userData;
            configuration = config;
        }

        private async Task<ContractHandler> deploy()
        {
            privateKey = configuration["accPKMarketplace"];
            acc = new Nethereum.Web3.Accounts.Account(privateKey, 444444444500);

            web3 = new Web3(acc, url);
            web3.TransactionManager.UseLegacyAsDefault = true;

            var marketPlaceDeployment = new MarketPlaceDeployment();

            var transactionReceiptDeployment = await web3.Eth.GetContractDeploymentHandler<MarketPlaceDeployment>().SendRequestAndWaitForReceiptAsync(marketPlaceDeployment);
            var contractAddress = transactionReceiptDeployment.ContractAddress;
            
            return web3.Eth.GetContractHandler(contractAddress);
        }

        public async Task<string> addDataPack(AddDataPackRequest2 request)
        {

            if (contractHandler == null) contractHandler = await deploy();

            var addDataPackFunction = new AddDataPackFunction();
            addDataPackFunction.Request = new AddDataPackRequest();
            addDataPackFunction.Request.Id = request.Id;
            addDataPackFunction.Request.PricePerUnit = request.PricePerUnit;
            addDataPackFunction.Request.Organization = request.Organization;
            addDataPackFunction.Request.RequestedAttributes = request.RequestedAttributes;
            var addDataPackFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(addDataPackFunction);

            return "success";
        }

        public async Task<BuyDataOutputDTO2> buyData(BuyDataRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var buyDataFunction = new BuyDataFunction();
            buyDataFunction.Request = request;

            Console.WriteLine(buyDataFunction.Request.Organization);
            Console.WriteLine(buyDataFunction.Request.DataPackID);
            Console.WriteLine(buyDataFunction.Request.Attributes.Count);


            BuyDataOutputDTO buyDataFunctionTxnReceipt = await contractHandler.QueryDeserializingToObjectAsync<BuyDataFunction, BuyDataOutputDTO>(buyDataFunction);

            BuyDataOutputDTO2 ret = new BuyDataOutputDTO2();

            if (buyDataFunctionTxnReceipt != null)
            {
                if (buyDataFunctionTxnReceipt.ReturnValue1.Status == "success")
                {
                    //await userData.updateBalance(request.UserID, (int)buyDataFunctionTxnReceipt.ReturnValue1.Amount);
                }

                //buyDataFunction.Request.Attributes.ForEach(attr => Console.WriteLine("Here: " + attr.Name));

                ret.ReturnValue1 = new BuyDataResponse2();
                ret.ReturnValue1.Status = buyDataFunctionTxnReceipt.ReturnValue1.Status;
                ret.ReturnValue1.Amount = (int)buyDataFunctionTxnReceipt.ReturnValue1.Amount;

            }

            return ret;
        }

        public async Task<string> createOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var createOrganizationFunction = new CreateOrganizationFunction();
            createOrganizationFunction.Request = request;
            var createOrganizationFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(createOrganizationFunction);

            return "success";
        }

        public async Task<GetOrganizationOutputDTO2> getOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var getOrganizationFunction = new GetOrganizationFunction();
            getOrganizationFunction.Request = request;
            var getOrganizationOutputDTO = await contractHandler.QueryDeserializingToObjectAsync<GetOrganizationFunction, GetOrganizationOutputDTO>(getOrganizationFunction);

            GetOrganizationOutputDTO2 ret = new GetOrganizationOutputDTO2();
            ret.ReturnValue1 = new OrganizationResponse2();

            ret.ReturnValue1.Id = getOrganizationOutputDTO.ReturnValue1.Id;
            ret.ReturnValue1.Balance = (int) getOrganizationOutputDTO.ReturnValue1.Balance;
            ret.ReturnValue1.Status = getOrganizationOutputDTO.ReturnValue1.Status;

            ret.ReturnValue1.Packs = new List<DataPackResponse2>();

            Console.WriteLine(getOrganizationOutputDTO.ReturnValue1.Packs.Count);

            for (int i=0; i< getOrganizationOutputDTO.ReturnValue1.Packs.Count; i++)
            {
                Console.WriteLine(getOrganizationOutputDTO.ReturnValue1.Packs[i].Received.Count);
                DataPackResponse2 p = new DataPackResponse2();
                p.Id = getOrganizationOutputDTO.ReturnValue1.Packs[i].Id;
                p.PricePerUnit = (int) getOrganizationOutputDTO.ReturnValue1.Packs[i].PricePerUnit;
                p.Received = getOrganizationOutputDTO.ReturnValue1.Packs[i].Received;

                ret.ReturnValue1.Packs.Add(p);
            }

            return ret;
        }

        public async Task<GetAllOrganizationsOutputDTO2> getAllOrganizations(string id)
        {

            var getAllOrganizationsFunction = new GetAllOrganizationsFunction();
            getAllOrganizationsFunction.Id = id;
            var temp = await contractHandler.QueryDeserializingToObjectAsync<GetAllOrganizationsFunction, GetAllOrganizationsOutputDTO>(getAllOrganizationsFunction);

            //var temp = await contractHandler.QueryDeserializingToObjectAsync<GetAllOrganizationsFunction, GetAllOrganizationsOutputDTO>();

            var ret = new GetAllOrganizationsOutputDTO2();
            ret.ReturnValue1 = new List<AllOrganizationResponse2>();

            for (int i=0; i<temp.ReturnValue1.Count; i++)
            {
                Console.WriteLine(temp.ReturnValue1[i].Id);
                Console.WriteLine(temp.ReturnValue1[i].Organization);

                AllOrganizationResponse2 p = new AllOrganizationResponse2();

                p.Id = temp.ReturnValue1[i].Id;
                p.PricePerUnit = (int) temp.ReturnValue1[i].PricePerUnit;
                p.Organization = temp.ReturnValue1[i].Organization;

                p.Attributes = temp.ReturnValue1[i].Attributes;
                
                ret.ReturnValue1.Add(p);
            }

            return ret;
        }
    }

    public partial class MarketPlaceDeployment : MarketPlaceDeploymentBase
    {
        public MarketPlaceDeployment() : base(BYTECODE) { }
        public MarketPlaceDeployment(string byteCode) : base(byteCode) { }
    }

    public class MarketPlaceDeploymentBase : ContractDeploymentMessage
    {
        public static string BYTECODE = "0x608060405234801561001057600080fd5b50612d4b806100206000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c806317d104f81461005c57806320b0a34b1461007857806373001f80146100a8578063804a18b8146100d85780638d0f9c6814610108575b600080fd5b61007660048036038101906100719190611e48565b610124565b005b610092600480360381019061008d9190611e91565b610327565b60405161009f9190612166565b60405180910390f35b6100c260048036038101906100bd9190612210565b6109b6565b6040516100cf91906125ef565b60405180910390f35b6100f260048036038101906100ed9190612862565b611306565b6040516100ff91906128e8565b60405180910390f35b610122600480360381019061011d9190612210565b61190b565b005b60006003826000015160405161013a9190612946565b9081526020016040518091039020600301600081548092919061015c9061298c565b91905055905081602001516003836000015160405161017b9190612946565b9081526020016040518091039020600401600083815260200190815260200160002060000190816101ac9190612be0565b508160400151600383600001516040516101c69190612946565b9081526020016040518091039020600401600083815260200190815260200160002060010181905550816060015151600383600001516040516102099190612946565b90815260200160405180910390206004016000838152602001908152602001600020600201819055506000600383600001516040516102489190612946565b908152602001604051809103902060040160008381526020019081526020016000206004018190555060005b82606001515181101561030a578260600151818151811061029857610297612cb2565b5b6020026020010151600384600001516040516102b49190612946565b90815260200160405180910390206004016000848152602001908152602001600020600301600083815260200190815260200160002090816102f69190612be0565b5080806103029061298c565b915050610274565b506001600081548092919061031e9061298c565b91905055505050565b6060600060015467ffffffffffffffff81111561034757610346611b26565b5b60405190808252806020026020018201604052801561038057816020015b61036d611a3d565b8152602001906001900390816103655790505b509050606060005b6000548110156109ab576002600082815260200190815260200160002080546103b090612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546103dc90612a03565b80156104295780601f106103fe57610100808354040283529160200191610429565b820191906000526020600020905b81548152906001019060200180831161040c57829003601f168201915b5050505050915060006003836040516104429190612946565b908152602001604051809103902060030154905060005b81811015610996576000805b6003866040516104759190612946565b908152602001604051809103902060040160008481526020019081526020016000206004015481101561059a5761057d6003876040516104b59190612946565b90815260200160405180910390206004016000858152602001908152602001600020600501600083815260200190815260200160002060000180546104f990612a03565b80601f016020809104026020016040519081016040528092919081815260200182805461052590612a03565b80156105725780601f1061054757610100808354040283529160200191610572565b820191906000526020600020905b81548152906001019060200180831161055557829003601f168201915b50505050508a611a12565b1561058757600191505b80806105929061298c565b915050610465565b5080156105a75750610983565b6003856040516105b79190612946565b908152602001604051809103902060000180546105d390612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546105ff90612a03565b801561064c5780601f106106215761010080835404028352916020019161064c565b820191906000526020600020905b81548152906001019060200180831161062f57829003601f168201915b505050505086838151811061066457610663612cb2565b5b6020026020010151600001819052506003856040516106839190612946565b9081526020016040518091039020600401600083815260200190815260200160002060000180546106b390612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546106df90612a03565b801561072c5780601f106107015761010080835404028352916020019161072c565b820191906000526020600020905b81548152906001019060200180831161070f57829003601f168201915b505050505086838151811061074457610743612cb2565b5b6020026020010151602001819052506003856040516107639190612946565b908152602001604051809103902060040160008381526020019081526020016000206001015486838151811061079c5761079b612cb2565b5b6020026020010151604001818152505060006003866040516107be9190612946565b908152602001604051809103902060040160008481526020019081526020016000206002015490508067ffffffffffffffff811115610800576107ff611b26565b5b60405190808252806020026020018201604052801561083357816020015b606081526020019060019003908161081e5790505b5087848151811061084757610846612cb2565b5b60200260200101516060018190525060005b8181101561097f576003876040516108719190612946565b90815260200160405180910390206004016000858152602001908152602001600020600301600082815260200190815260200160002080546108b290612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546108de90612a03565b801561092b5780601f106109005761010080835404028352916020019161092b565b820191906000526020600020905b81548152906001019060200180831161090e57829003601f168201915b505050505088858151811061094357610942612cb2565b5b602002602001015160600151828151811061096157610960612cb2565b5b602002602001018190525080806109779061298c565b915050610859565b5050505b808061098e9061298c565b915050610459565b505080806109a39061298c565b915050610388565b508192505050919050565b6109be611a65565b6109c6611a65565b610a818360200151600385600001516040516109e29190612946565b908152602001604051809103902060010180546109fe90612a03565b80601f0160208091040260200160405190810160405280929190818152602001828054610a2a90612a03565b8015610a775780601f10610a4c57610100808354040283529160200191610a77565b820191906000526020600020905b815481529060010190602001808311610a5a57829003601f168201915b5050505050611a12565b610acc576040518060400160405280600681526020017f6661696c65640000000000000000000000000000000000000000000000000000815250816040018190525080915050611301565b826000015181600001819052506040518060400160405280600781526020017f7375636365737300000000000000000000000000000000000000000000000000815250816040018190525060038360000151604051610b2b9190612946565b908152602001604051809103902060020154816020018181525050600060038460000151604051610b5c9190612946565b90815260200160405180910390206003015490508067ffffffffffffffff811115610b8a57610b89611b26565b5b604051908082528060200260200182016040528015610bc357816020015b610bb0611a8d565b815260200190600190039081610ba85790505b50826060018190525060005b818110156112fa5760038560000151604051610beb9190612946565b908152602001604051809103902060040160008281526020019081526020016000206000018054610c1b90612a03565b80601f0160208091040260200160405190810160405280929190818152602001828054610c4790612a03565b8015610c945780601f10610c6957610100808354040283529160200191610c94565b820191906000526020600020905b815481529060010190602001808311610c7757829003601f168201915b505050505083606001518281518110610cb057610caf612cb2565b5b60200260200101516000018190525060038560000151604051610cd39190612946565b908152602001604051809103902060040160008281526020019081526020016000206001015483606001518281518110610d1057610d0f612cb2565b5b6020026020010151602001818152505060038560000151604051610d349190612946565b908152602001604051809103902060040160008281526020019081526020016000206004015467ffffffffffffffff811115610d7357610d72611b26565b5b604051908082528060200260200182016040528015610dac57816020015b610d99611aae565b815260200190600190039081610d915790505b5083606001518281518110610dc457610dc3612cb2565b5b60200260200101516040018190525060005b60038660000151604051610dea9190612946565b90815260200160405180910390206004016000838152602001908152602001600020600401548110156112e65760038660000151604051610e2b9190612946565b9081526020016040518091039020600401600083815260200190815260200160002060050160008281526020019081526020016000206000018054610e6f90612a03565b80601f0160208091040260200160405190810160405280929190818152602001828054610e9b90612a03565b8015610ee85780601f10610ebd57610100808354040283529160200191610ee8565b820191906000526020600020905b815481529060010190602001808311610ecb57829003601f168201915b505050505084606001518381518110610f0457610f03612cb2565b5b6020026020010151604001518281518110610f2257610f21612cb2565b5b602002602001015160000181905250600060038760000151604051610f479190612946565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001015490508067ffffffffffffffff811115610f9d57610f9c611b26565b5b604051908082528060200260200182016040528015610fd657816020015b610fc3611ac8565b815260200190600190039081610fbb5790505b5085606001518481518110610fee57610fed612cb2565b5b602002602001015160400151838151811061100c5761100b612cb2565b5b60200260200101516020018190525060005b818110156112d1576003886000015160405161103a9190612946565b9081526020016040518091039020600401600085815260200190815260200160002060050160008481526020019081526020016000206002016000828152602001908152602001600020600001805461109290612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546110be90612a03565b801561110b5780601f106110e05761010080835404028352916020019161110b565b820191906000526020600020905b8154815290600101906020018083116110ee57829003601f168201915b50505050508660600151858151811061112757611126612cb2565b5b602002602001015160400151848151811061114557611144612cb2565b5b602002602001015160200151828151811061116357611162612cb2565b5b602002602001015160000181905250600388600001516040516111869190612946565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600082815260200190815260200160002060010180546111de90612a03565b80601f016020809104026020016040519081016040528092919081815260200182805461120a90612a03565b80156112575780601f1061122c57610100808354040283529160200191611257565b820191906000526020600020905b81548152906001019060200180831161123a57829003601f168201915b50505050508660600151858151811061127357611272612cb2565b5b602002602001015160400151848151811061129157611290612cb2565b5b60200260200101516020015182815181106112af576112ae612cb2565b5b60200260200101516020018190525080806112c99061298c565b91505061101e565b505080806112de9061298c565b915050610dd6565b5080806112f29061298c565b915050610bcf565b5081925050505b919050565b61130e611ae2565b611316611ae2565b60005b6003846020015160405161132d9190612946565b908152602001604051809103902060030154811015611900576114156003856020015160405161135d9190612946565b90815260200160405180910390206004016000838152602001908152602001600020600001805461138d90612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546113b990612a03565b80156114065780601f106113db57610100808354040283529160200191611406565b820191906000526020600020905b8154815290600101906020018083116113e957829003601f168201915b50505050508560400151611a12565b156118ed5760005b600385602001516040516114319190612946565b90815260200160405180910390206004016000838152602001908152602001600020600401548110156115a257611541600386602001516040516114759190612946565b90815260200160405180910390206004016000848152602001908152602001600020600501600083815260200190815260200160002060000180546114b990612a03565b80601f01602080910402602001604051908101604052809291908181526020018280546114e590612a03565b80156115325780601f1061150757610100808354040283529160200191611532565b820191906000526020600020905b81548152906001019060200180831161151557829003601f168201915b50505050508660000151611a12565b1561158f576040518060400160405280600681526020017f6661696c656400000000000000000000000000000000000000000000000000008152508360000181905250829350505050611906565b808061159a9061298c565b91505061141d565b506000600385602001516040516115b99190612946565b9081526020016040518091039020600401600083815260200190815260200160002060040160008154809291906115ef9061298c565b91905055905084600001516003866020015160405161160e9190612946565b90815260200160405180910390206004016000848152602001908152602001600020600501600083815260200190815260200160002060000190816116539190612be0565b508460600151516003866020015160405161166e9190612946565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001018190555060005b8560600151518110156117f057856060015181815181106116d2576116d1612cb2565b5b602002602001015160000151600387602001516040516116f29190612946565b9081526020016040518091039020600401600085815260200190815260200160002060050160008481526020019081526020016000206002016000838152602001908152602001600020600001908161174b9190612be0565b508560600151818151811061176357611762612cb2565b5b602002602001015160200151600387602001516040516117839190612946565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600083815260200190815260200160002060010190816117dc9190612be0565b5080806117e89061298c565b9150506116ae565b506040518060400160405280600781526020017f73756363657373000000000000000000000000000000000000000000000000008152508360000181905250600385602001516040516118439190612946565b9081526020016040518091039020600401600083815260200190815260200160002060010154836020018181525050600385602001516040516118869190612946565b9081526020016040518091039020600401600083815260200190815260200160002060010154600386602001516040516118c09190612946565b908152602001604051809103902060020160008282546118e09190612ce1565b9250508190555050611900565b80806118f89061298c565b915050611319565b50809150505b919050565b8060000151600382600001516040516119249190612946565b908152602001604051809103902060000190816119419190612be0565b5080602001516003826000015160405161195b9190612946565b908152602001604051809103902060010190816119789190612be0565b5060006003826000015160405161198f9190612946565b9081526020016040518091039020600301819055506064600382600001516040516119ba9190612946565b90815260200160405180910390206002018190555060008060008154809291906119e39061298c565b9190505590508160000151600260008381526020019081526020016000209081611a0d9190612be0565b505050565b60008180519060200120838051906020012003611a325760019050611a37565b600090505b92915050565b6040518060800160405280606081526020016060815260200160008152602001606081525090565b6040518060800160405280606081526020016000815260200160608152602001606081525090565b60405180606001604052806060815260200160008152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001600081525090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b611b5e82611b15565b810181811067ffffffffffffffff82111715611b7d57611b7c611b26565b5b80604052505050565b6000611b90611afc565b9050611b9c8282611b55565b919050565b600080fd5b600080fd5b600080fd5b600067ffffffffffffffff821115611bcb57611bca611b26565b5b611bd482611b15565b9050602081019050919050565b82818337600083830152505050565b6000611c03611bfe84611bb0565b611b86565b905082815260208101848484011115611c1f57611c1e611bab565b5b611c2a848285611be1565b509392505050565b600082601f830112611c4757611c46611ba6565b5b8135611c57848260208601611bf0565b91505092915050565b6000819050919050565b611c7381611c60565b8114611c7e57600080fd5b50565b600081359050611c9081611c6a565b92915050565b600067ffffffffffffffff821115611cb157611cb0611b26565b5b602082029050602081019050919050565b600080fd5b6000611cda611cd584611c96565b611b86565b90508083825260208201905060208402830185811115611cfd57611cfc611cc2565b5b835b81811015611d4457803567ffffffffffffffff811115611d2257611d21611ba6565b5b808601611d2f8982611c32565b85526020850194505050602081019050611cff565b5050509392505050565b600082601f830112611d6357611d62611ba6565b5b8135611d73848260208601611cc7565b91505092915050565b600060808284031215611d9257611d91611b10565b5b611d9c6080611b86565b9050600082013567ffffffffffffffff811115611dbc57611dbb611ba1565b5b611dc884828501611c32565b600083015250602082013567ffffffffffffffff811115611dec57611deb611ba1565b5b611df884828501611c32565b6020830152506040611e0c84828501611c81565b604083015250606082013567ffffffffffffffff811115611e3057611e2f611ba1565b5b611e3c84828501611d4e565b60608301525092915050565b600060208284031215611e5e57611e5d611b06565b5b600082013567ffffffffffffffff811115611e7c57611e7b611b0b565b5b611e8884828501611d7c565b91505092915050565b600060208284031215611ea757611ea6611b06565b5b600082013567ffffffffffffffff811115611ec557611ec4611b0b565b5b611ed184828501611c32565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b60005b83811015611f40578082015181840152602081019050611f25565b83811115611f4f576000848401525b50505050565b6000611f6082611f06565b611f6a8185611f11565b9350611f7a818560208601611f22565b611f8381611b15565b840191505092915050565b611f9781611c60565b82525050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b6000611fd58383611f55565b905092915050565b6000602082019050919050565b6000611ff582611f9d565b611fff8185611fa8565b93508360208202850161201185611fb9565b8060005b8581101561204d578484038952815161202e8582611fc9565b945061203983611fdd565b925060208a01995050600181019050612015565b50829750879550505050505092915050565b6000608083016000830151848203600086015261207c8282611f55565b915050602083015184820360208601526120968282611f55565b91505060408301516120ab6040860182611f8e565b50606083015184820360608601526120c38282611fea565b9150508091505092915050565b60006120dc838361205f565b905092915050565b6000602082019050919050565b60006120fc82611eda565b6121068185611ee5565b93508360208202850161211885611ef6565b8060005b85811015612154578484038952815161213585826120d0565b9450612140836120e4565b925060208a0199505060018101905061211c565b50829750879550505050505092915050565b6000602082019050818103600083015261218081846120f1565b905092915050565b60006040828403121561219e5761219d611b10565b5b6121a86040611b86565b9050600082013567ffffffffffffffff8111156121c8576121c7611ba1565b5b6121d484828501611c32565b600083015250602082013567ffffffffffffffff8111156121f8576121f7611ba1565b5b61220484828501611c32565b60208301525092915050565b60006020828403121561222657612225611b06565b5b600082013567ffffffffffffffff81111561224457612243611b0b565b5b61225084828501612188565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600060408301600083015184820360008601526122fa8282611f55565b915050602083015184820360208601526123148282611f55565b9150508091505092915050565b600061232d83836122dd565b905092915050565b6000602082019050919050565b600061234d826122b1565b61235781856122bc565b935083602082028501612369856122cd565b8060005b858110156123a557848403895281516123868582612321565b945061239183612335565b925060208a0199505060018101905061236d565b50829750879550505050505092915050565b600060408301600083015184820360008601526123d48282611f55565b915050602083015184820360208601526123ee8282612342565b9150508091505092915050565b600061240783836123b7565b905092915050565b6000602082019050919050565b600061242782612285565b6124318185612290565b935083602082028501612443856122a1565b8060005b8581101561247f578484038952815161246085826123fb565b945061246b8361240f565b925060208a01995050600181019050612447565b50829750879550505050505092915050565b600060608301600083015184820360008601526124ae8282611f55565b91505060208301516124c36020860182611f8e565b50604083015184820360408601526124db828261241c565b9150508091505092915050565b60006124f48383612491565b905092915050565b6000602082019050919050565b600061251482612259565b61251e8185612264565b93508360208202850161253085612275565b8060005b8581101561256c578484038952815161254d85826124e8565b9450612558836124fc565b925060208a01995050600181019050612534565b50829750879550505050505092915050565b6000608083016000830151848203600086015261259b8282611f55565b91505060208301516125b06020860182611f8e565b50604083015184820360408601526125c88282611f55565b915050606083015184820360608601526125e28282612509565b9150508091505092915050565b60006020820190508181036000830152612609818461257e565b905092915050565b600067ffffffffffffffff82111561262c5761262b611b26565b5b602082029050602081019050919050565b60006040828403121561265357612652611b10565b5b61265d6040611b86565b9050600082013567ffffffffffffffff81111561267d5761267c611ba1565b5b61268984828501611c32565b600083015250602082013567ffffffffffffffff8111156126ad576126ac611ba1565b5b6126b984828501611c32565b60208301525092915050565b60006126d86126d384612611565b611b86565b905080838252602082019050602084028301858111156126fb576126fa611cc2565b5b835b8181101561274257803567ffffffffffffffff8111156127205761271f611ba6565b5b80860161272d898261263d565b855260208501945050506020810190506126fd565b5050509392505050565b600082601f83011261276157612760611ba6565b5b81356127718482602086016126c5565b91505092915050565b6000608082840312156127905761278f611b10565b5b61279a6080611b86565b9050600082013567ffffffffffffffff8111156127ba576127b9611ba1565b5b6127c684828501611c32565b600083015250602082013567ffffffffffffffff8111156127ea576127e9611ba1565b5b6127f684828501611c32565b602083015250604082013567ffffffffffffffff81111561281a57612819611ba1565b5b61282684828501611c32565b604083015250606082013567ffffffffffffffff81111561284a57612849611ba1565b5b6128568482850161274c565b60608301525092915050565b60006020828403121561287857612877611b06565b5b600082013567ffffffffffffffff81111561289657612895611b0b565b5b6128a28482850161277a565b91505092915050565b600060408301600083015184820360008601526128c88282611f55565b91505060208301516128dd6020860182611f8e565b508091505092915050565b6000602082019050818103600083015261290281846128ab565b905092915050565b600081905092915050565b600061292082611f06565b61292a818561290a565b935061293a818560208601611f22565b80840191505092915050565b60006129528284612915565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061299782611c60565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82036129c9576129c861295d565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680612a1b57607f821691505b602082108103612a2e57612a2d6129d4565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302612a967fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82612a59565b612aa08683612a59565b95508019841693508086168417925050509392505050565b6000819050919050565b6000612add612ad8612ad384611c60565b612ab8565b611c60565b9050919050565b6000819050919050565b612af783612ac2565b612b0b612b0382612ae4565b848454612a66565b825550505050565b600090565b612b20612b13565b612b2b818484612aee565b505050565b5b81811015612b4f57612b44600082612b18565b600181019050612b31565b5050565b601f821115612b9457612b6581612a34565b612b6e84612a49565b81016020851015612b7d578190505b612b91612b8985612a49565b830182612b30565b50505b505050565b600082821c905092915050565b6000612bb760001984600802612b99565b1980831691505092915050565b6000612bd08383612ba6565b9150826002028217905092915050565b612be982611f06565b67ffffffffffffffff811115612c0257612c01611b26565b5b612c0c8254612a03565b612c17828285612b53565b600060209050601f831160018114612c4a5760008415612c38578287015190505b612c428582612bc4565b865550612caa565b601f198416612c5886612a34565b60005b82811015612c8057848901518255600182019150602085019450602081019050612c5b565b86831015612c9d5784890151612c99601f891682612ba6565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b6000612cec82611c60565b9150612cf783611c60565b925082821015612d0a57612d0961295d565b5b82820390509291505056fea2646970667358221220a891b3e8112e9e29b89f7871737031164188bd06ced4b4cdc62c43434ea8456a64736f6c634300080f0033";
        public MarketPlaceDeploymentBase() : base(BYTECODE) { }
        public MarketPlaceDeploymentBase(string byteCode) : base(byteCode) { }

    }

    public partial class AddDataPackFunction : AddDataPackFunctionBase { }

    [Function("addDataPack")]
    public class AddDataPackFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual AddDataPackRequest Request { get; set; }
    }

    public partial class BuyDataFunction : BuyDataFunctionBase { }

    [Function("buyData", typeof(BuyDataOutputDTO))]
    public class BuyDataFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual BuyDataRequest Request { get; set; }
    }

    public partial class CreateOrganizationFunction : CreateOrganizationFunctionBase { }

    [Function("createOrganization")]
    public class CreateOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }

    public partial class GetAllOrganizationsFunction : GetAllOrganizationsFunctionBase { }

    [Function("getAllOrganizations", typeof(GetAllOrganizationsOutputDTO))]
    public class GetAllOrganizationsFunctionBase : FunctionMessage
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
    }

    public partial class GetOrganizationFunction : GetOrganizationFunctionBase { }

    [Function("getOrganization", typeof(GetOrganizationOutputDTO))]
    public class GetOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }



    public partial class BuyDataOutputDTO : BuyDataOutputDTOBase { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse ReturnValue1 { get; set; }
    }



    public partial class GetAllOrganizationsOutputDTO : GetAllOrganizationsOutputDTOBase { }

    [FunctionOutput]
    public class GetAllOrganizationsOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple[]", "", 1)]
        public virtual List<AllOrganizationResponse> ReturnValue1 { get; set; }
    }

    public partial class GetOrganizationOutputDTO : GetOrganizationOutputDTOBase { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse ReturnValue1 { get; set; }
    }

    public partial class AddDataPackRequest : AddDataPackRequestBase { }

    public class AddDataPackRequestBase
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse : BuyDataResponseBase { }

    public class BuyDataResponseBase
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual BigInteger Amount { get; set; }
    }

    public partial class BuyDataRequest : BuyDataRequestBase { }

    public class BuyDataRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("string", "organization", 2)]
        public virtual string Organization { get; set; }
        [Parameter("string", "dataPackID", 3)]
        public virtual string DataPackID { get; set; }
        [Parameter("tuple[]", "attributes", 4)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class CreateOrgRequest : CreateOrgRequestBase { }

    public class CreateOrgRequestBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("string", "password", 2)]
        public virtual string Password { get; set; }
    }

    public partial class AllOrganizationResponse : AllOrganizationResponseBase { }

    public class AllOrganizationResponseBase
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("string[]", "attributes", 4)]
        public virtual List<string> Attributes { get; set; }
    }

    public partial class DataPackReceivedRequest : DataPackReceivedRequestBase { }

    public class DataPackReceivedRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("tuple[]", "attributes", 2)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class DataPackResponse : DataPackResponseBase { }

    public class DataPackResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }

    public partial class OrganizationResponse : OrganizationResponseBase { }

    public class OrganizationResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual BigInteger Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse> Packs { get; set; }
    }




    public partial class GetAllOrganizationsOutputDTO2 : GetAllOrganizationsOutputDTOBase2 { }

    [FunctionOutput]
    public class GetAllOrganizationsOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple[]", "", 1)]
        public virtual List<AllOrganizationResponse2> ReturnValue1 { get; set; }
    }

    public partial class AllOrganizationResponse2 : AllOrganizationResponseBase2 { }

    public class AllOrganizationResponseBase2
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("string[]", "attributes", 4)]
        public virtual List<string> Attributes { get; set; }
    }





    public partial class DataPackResponse2 : DataPackResponseBase2 { }

    public class DataPackResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }
    public partial class GetOrganizationOutputDTO2 : GetOrganizationOutputDTOBase2 { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse2 ReturnValue1 { get; set; }
    }

    public partial class OrganizationResponse2 : OrganizationResponseBase2 { }

    public class OrganizationResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual int Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse2> Packs { get; set; }
    }

    public partial class AddDataPackRequest2 : AddDataPackRequestBase2 { }

    public class AddDataPackRequestBase2
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse2 : BuyDataResponseBase2 { }

    public class BuyDataResponseBase2
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual int Amount { get; set; }
    }
    public partial class BuyDataOutputDTO2 : BuyDataOutputDTOBase2 { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse2 ReturnValue1 { get; set; }
    }
}

using ExploringSelfSovereignIdentityAPI.Models.Request;
using ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain;
using ExploringSelfSovereignIdentityAPI.Services.UserDataService;
using MediatR;
using Nethereum.ABI.FunctionEncoding.Attributes;
using Nethereum.Contracts;
using Nethereum.Contracts.ContractHandlers;
using Nethereum.Contracts.DeploymentHandlers;
using Nethereum.Web3;
using Org.BouncyCastle.Asn1.Mozilla;
using Org.BouncyCastle.Asn1.Ocsp;
using System;
using System.Collections.Generic;
using System.Numerics;
using System.Threading.Tasks;
using Attribute = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.Attribute;
using IUserDataService = ExploringSelfSovereignIdentityAPI.Services.NetheriumBlockChain.IUserDataService;

namespace ExploringSelfSovereignIdentityAPI.Services
{
    public class MarketPlaceService : IMarketPlaceService
    {

        /*static string url = "http://127.0.0.1:8545";
        static string privateKey = "734674bd34f2476f15c6d5f6c8c1c7c92e465921e546771d088b958607531d10";
        private readonly string senderAddress = "0x8A1f48B91fbDC94b82E1997c2630466c5FaCf38b";
        private static string contractAddress = "0x7D6FAec0a4833Ad806EBCbe7d1BFe66caCF0a961";

        static Web3 web3 = new Web3(new Nethereum.Web3.Accounts.Account(privateKey), url);

        private ContractHandler contractHandler = web3.Eth.GetContractHandler(contractAddress);

        public MarketPlaceService()
        {
            web3.TransactionManager.UseLegacyAsDefault = true;
        }*/

        private static string url = "http://testchain.nethereum.com:8545";
        private static string privateKey = "0x7580e7fb49df1c861f0050fae31c2224c6aba908e116b8da44ee8cd927b990b0";
        static Web3 web3 = new Web3(new Nethereum.Web3.Accounts.Account(privateKey, 444444444500), url);

        private static ContractHandler contractHandler;

        private IUserDataService userData;

        public MarketPlaceService(IUserDataService userData)
        {
            this.userData = userData;
        }

        private async Task<ContractHandler> deploy()
        {
            var marketPlaceDeployment = new MarketPlaceDeployment();

            var transactionReceiptDeployment = await web3.Eth.GetContractDeploymentHandler<MarketPlaceDeployment>().SendRequestAndWaitForReceiptAsync(marketPlaceDeployment);
            var contractAddress = transactionReceiptDeployment.ContractAddress;
            
            return web3.Eth.GetContractHandler(contractAddress);
        }

        public async Task<string> addDataPack(AddDataPackRequest2 request)
        {

            if (contractHandler == null) contractHandler = await deploy();

            var addDataPackFunction = new AddDataPackFunction();
            addDataPackFunction.Request = new AddDataPackRequest();
            addDataPackFunction.Request.Id = request.Id;
            addDataPackFunction.Request.PricePerUnit = request.PricePerUnit;
            addDataPackFunction.Request.Organization = request.Organization;
            addDataPackFunction.Request.RequestedAttributes = request.RequestedAttributes;
            var addDataPackFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(addDataPackFunction);

            return "success";
        }

        public async Task<BuyDataOutputDTO2> buyData(BuyDataRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var buyDataFunction = new BuyDataFunction();
            buyDataFunction.Request = request;
            BuyDataOutputDTO buyDataFunctionTxnReceipt = await contractHandler.QueryDeserializingToObjectAsync<BuyDataFunction, BuyDataOutputDTO>(buyDataFunction);

            if (buyDataFunctionTxnReceipt.ReturnValue1.Status == "success")
            {
                await userData.updateBalance(request.UserID, (int) buyDataFunctionTxnReceipt.ReturnValue1.Amount);
            }

            BuyDataOutputDTO2 ret = new BuyDataOutputDTO2();
            ret.ReturnValue1 = new BuyDataResponse2();
            ret.ReturnValue1.Status = buyDataFunctionTxnReceipt.ReturnValue1.Status;
            ret.ReturnValue1.Amount = (int) buyDataFunctionTxnReceipt.ReturnValue1.Amount;

            return ret;
        }

        public async Task<string> createOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var createOrganizationFunction = new CreateOrganizationFunction();
            createOrganizationFunction.Request = request;
            var createOrganizationFunctionTxnReceipt = await contractHandler.SendRequestAndWaitForReceiptAsync(createOrganizationFunction);

            return "success";
        }

        public async Task<GetOrganizationOutputDTO2> getOrganization(CreateOrgRequest request)
        {
            if (contractHandler == null) contractHandler = await deploy();

            var getOrganizationFunction = new GetOrganizationFunction();
            getOrganizationFunction.Request = request;
            var getOrganizationOutputDTO = await contractHandler.QueryDeserializingToObjectAsync<GetOrganizationFunction, GetOrganizationOutputDTO>(getOrganizationFunction);

            GetOrganizationOutputDTO2 ret = new GetOrganizationOutputDTO2();
            ret.ReturnValue1 = new OrganizationResponse2();

            ret.ReturnValue1.Id = getOrganizationOutputDTO.ReturnValue1.Id;
            ret.ReturnValue1.Balance = (int) getOrganizationOutputDTO.ReturnValue1.Balance;
            ret.ReturnValue1.Status = getOrganizationOutputDTO.ReturnValue1.Status;

            ret.ReturnValue1.Packs = new List<DataPackResponse2>();

            for (int i=0; i< getOrganizationOutputDTO.ReturnValue1.Packs.Count; i++)
            {
                DataPackResponse2 p = new DataPackResponse2();
                p.Id = getOrganizationOutputDTO.ReturnValue1.Packs[i].Id;
                p.PricePerUnit = (int) getOrganizationOutputDTO.ReturnValue1.Packs[i].PricePerUnit;
                p.Received = getOrganizationOutputDTO.ReturnValue1.Packs[i].Received;

                ret.ReturnValue1.Packs.Add(p);
            }

            return ret;
        }
    }

    public partial class MarketPlaceDeployment : MarketPlaceDeploymentBase
    {
        public MarketPlaceDeployment() : base(BYTECODE) { }
        public MarketPlaceDeployment(string byteCode) : base(byteCode) { }
    }

    public class MarketPlaceDeploymentBase : ContractDeploymentMessage
    {
        public static string BYTECODE = "0x608060405234801561001057600080fd5b506123b9806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806317d104f81461005157806373001f801461006d578063804a18b81461009d5780638d0f9c68146100cd575b600080fd5b61006b60048036038101906100669190611716565b6100e9565b005b610087600480360381019061008291906117e7565b6102d2565b6040516100949190611c5d565b60405180910390f35b6100b760048036038101906100b29190611ed0565b610c20565b6040516100c49190611f56565b60405180910390f35b6100e760048036038101906100e291906117e7565b611242565b005b60008082600001516040516100fe9190611fb4565b9081526020016040518091039020600301600081548092919061012090611ffa565b91905055905081602001516000836000015160405161013f9190611fb4565b908152602001604051809103902060040160008381526020019081526020016000206000019081610170919061224e565b5081604001516000836000015160405161018a9190611fb4565b9081526020016040518091039020600401600083815260200190815260200160002060010181905550816060015151600083600001516040516101cd9190611fb4565b9081526020016040518091039020600401600083815260200190815260200160002060020181905550600080836000015160405161020b9190611fb4565b908152602001604051809103902060040160008381526020019081526020016000206004018190555060005b8260600151518110156102cd578260600151818151811061025b5761025a612320565b5b6020026020010151600084600001516040516102779190611fb4565b90815260200160405180910390206004016000848152602001908152602001600020600301600083815260200190815260200160002090816102b9919061224e565b5080806102c590611ffa565b915050610237565b505050565b6102da611333565b6102e2611333565b61039d8360200151600085600001516040516102fe9190611fb4565b9081526020016040518091039020600101805461031a90612071565b80601f016020809104026020016040519081016040528092919081815260200182805461034690612071565b80156103935780601f1061036857610100808354040283529160200191610393565b820191906000526020600020905b81548152906001019060200180831161037657829003601f168201915b5050505050611308565b6103e8576040518060400160405280600681526020017f6661696c65640000000000000000000000000000000000000000000000000000815250816040018190525080915050610c1b565b826000015181600001819052506040518060400160405280600781526020017f73756363657373000000000000000000000000000000000000000000000000008152508160400181905250600083600001516040516104479190611fb4565b90815260200160405180910390206002015481602001818152505060008084600001516040516104779190611fb4565b90815260200160405180910390206003015490508067ffffffffffffffff8111156104a5576104a46113f4565b5b6040519080825280602002602001820160405280156104de57816020015b6104cb61135b565b8152602001906001900390816104c35790505b50826060018190525060005b81811015610c1457600085600001516040516105069190611fb4565b90815260200160405180910390206004016000828152602001908152602001600020600001805461053690612071565b80601f016020809104026020016040519081016040528092919081815260200182805461056290612071565b80156105af5780601f10610584576101008083540402835291602001916105af565b820191906000526020600020905b81548152906001019060200180831161059257829003601f168201915b5050505050836060015182815181106105cb576105ca612320565b5b602002602001015160000181905250600085600001516040516105ee9190611fb4565b90815260200160405180910390206004016000828152602001908152602001600020600101548360600151828151811061062b5761062a612320565b5b602002602001015160200181815250506000856000015160405161064f9190611fb4565b908152602001604051809103902060040160008281526020019081526020016000206004015467ffffffffffffffff81111561068e5761068d6113f4565b5b6040519080825280602002602001820160405280156106c757816020015b6106b461137c565b8152602001906001900390816106ac5790505b50836060015182815181106106df576106de612320565b5b60200260200101516040018190525060005b600086600001516040516107059190611fb4565b9081526020016040518091039020600401600083815260200190815260200160002060040154811015610c0057600086600001516040516107469190611fb4565b908152602001604051809103902060040160008381526020019081526020016000206005016000828152602001908152602001600020600001805461078a90612071565b80601f01602080910402602001604051908101604052809291908181526020018280546107b690612071565b80156108035780601f106107d857610100808354040283529160200191610803565b820191906000526020600020905b8154815290600101906020018083116107e657829003601f168201915b50505050508460600151838151811061081f5761081e612320565b5b602002602001015160400151828151811061083d5761083c612320565b5b60200260200101516000018190525060008087600001516040516108619190611fb4565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001015490508067ffffffffffffffff8111156108b7576108b66113f4565b5b6040519080825280602002602001820160405280156108f057816020015b6108dd611396565b8152602001906001900390816108d55790505b508560600151848151811061090857610907612320565b5b602002602001015160400151838151811061092657610925612320565b5b60200260200101516020018190525060005b81811015610beb57600088600001516040516109549190611fb4565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600082815260200190815260200160002060000180546109ac90612071565b80601f01602080910402602001604051908101604052809291908181526020018280546109d890612071565b8015610a255780601f106109fa57610100808354040283529160200191610a25565b820191906000526020600020905b815481529060010190602001808311610a0857829003601f168201915b505050505086606001518581518110610a4157610a40612320565b5b6020026020010151604001518481518110610a5f57610a5e612320565b5b6020026020010151602001518281518110610a7d57610a7c612320565b5b60200260200101516000018190525060008860000151604051610aa09190611fb4565b90815260200160405180910390206004016000858152602001908152602001600020600501600084815260200190815260200160002060020160008281526020019081526020016000206001018054610af890612071565b80601f0160208091040260200160405190810160405280929190818152602001828054610b2490612071565b8015610b715780601f10610b4657610100808354040283529160200191610b71565b820191906000526020600020905b815481529060010190602001808311610b5457829003601f168201915b505050505086606001518581518110610b8d57610b8c612320565b5b6020026020010151604001518481518110610bab57610baa612320565b5b6020026020010151602001518281518110610bc957610bc8612320565b5b6020026020010151602001819052508080610be390611ffa565b915050610938565b50508080610bf890611ffa565b9150506106f1565b508080610c0c90611ffa565b9150506104ea565b5081925050505b919050565b610c286113b0565b610c306113b0565b60005b60008460200151604051610c479190611fb4565b90815260200160405180910390206003015481101561123757610d2f60008560200151604051610c779190611fb4565b908152602001604051809103902060040160008381526020019081526020016000206000018054610ca790612071565b80601f0160208091040260200160405190810160405280929190818152602001828054610cd390612071565b8015610d205780601f10610cf557610100808354040283529160200191610d20565b820191906000526020600020905b815481529060010190602001808311610d0357829003601f168201915b50505050508560400151611308565b156112245760005b60008560200151604051610d4b9190611fb4565b9081526020016040518091039020600401600083815260200190815260200160002060040154811015610ebc57610e5b60008660200151604051610d8f9190611fb4565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206000018054610dd390612071565b80601f0160208091040260200160405190810160405280929190818152602001828054610dff90612071565b8015610e4c5780601f10610e2157610100808354040283529160200191610e4c565b820191906000526020600020905b815481529060010190602001808311610e2f57829003601f168201915b50505050508660000151611308565b15610ea9576040518060400160405280600681526020017f6661696c65640000000000000000000000000000000000000000000000000000815250836000018190525082935050505061123d565b8080610eb490611ffa565b915050610d37565b506000808560200151604051610ed29190611fb4565b908152602001604051809103902060040160008381526020019081526020016000206004016000815480929190610f0890611ffa565b919050559050846000015160008660200151604051610f279190611fb4565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206000019081610f6c919061224e565b5084606001515160008660200151604051610f879190611fb4565b9081526020016040518091039020600401600084815260200190815260200160002060050160008381526020019081526020016000206001018190555060005b8560600151518110156111095785606001518181518110610feb57610fea612320565b5b6020026020010151600001516000876020015160405161100b9190611fb4565b90815260200160405180910390206004016000858152602001908152602001600020600501600084815260200190815260200160002060020160008381526020019081526020016000206000019081611064919061224e565b508560600151818151811061107c5761107b612320565b5b6020026020010151602001516000876020015160405161109c9190611fb4565b908152602001604051809103902060040160008581526020019081526020016000206005016000848152602001908152602001600020600201600083815260200190815260200160002060010190816110f5919061224e565b50808061110190611ffa565b915050610fc7565b506040518060400160405280600781526020017f737563636573730000000000000000000000000000000000000000000000000081525083600001819052506000856020015160405161115c9190611fb4565b90815260200160405180910390206004016000838152602001908152602001600020600101548360200181815250506000856020015160405161119f9190611fb4565b9081526020016040518091039020600401600083815260200190815260200160002060010154600086602001516040516111d99190611fb4565b9081526020016040518091039020600201546111f5919061234f565b600086602001516040516112099190611fb4565b90815260200160405180910390206002018190555050611237565b808061122f90611ffa565b915050610c33565b50809150505b919050565b80600001516000826000015160405161125b9190611fb4565b90815260200160405180910390206000019081611278919061224e565b508060200151600082600001516040516112929190611fb4565b908152602001604051809103902060010190816112af919061224e565b5060008082600001516040516112c59190611fb4565b9081526020016040518091039020600301819055506064600082600001516040516112f09190611fb4565b90815260200160405180910390206002018190555050565b60008180519060200120838051906020012003611328576001905061132d565b600090505b92915050565b6040518060800160405280606081526020016000815260200160608152602001606081525090565b60405180606001604052806060815260200160008152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001606081525090565b604051806040016040528060608152602001600081525090565b6000604051905090565b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61142c826113e3565b810181811067ffffffffffffffff8211171561144b5761144a6113f4565b5b80604052505050565b600061145e6113ca565b905061146a8282611423565b919050565b600080fd5b600080fd5b600080fd5b600067ffffffffffffffff821115611499576114986113f4565b5b6114a2826113e3565b9050602081019050919050565b82818337600083830152505050565b60006114d16114cc8461147e565b611454565b9050828152602081018484840111156114ed576114ec611479565b5b6114f88482856114af565b509392505050565b600082601f83011261151557611514611474565b5b81356115258482602086016114be565b91505092915050565b6000819050919050565b6115418161152e565b811461154c57600080fd5b50565b60008135905061155e81611538565b92915050565b600067ffffffffffffffff82111561157f5761157e6113f4565b5b602082029050602081019050919050565b600080fd5b60006115a86115a384611564565b611454565b905080838252602082019050602084028301858111156115cb576115ca611590565b5b835b8181101561161257803567ffffffffffffffff8111156115f0576115ef611474565b5b8086016115fd8982611500565b855260208501945050506020810190506115cd565b5050509392505050565b600082601f83011261163157611630611474565b5b8135611641848260208601611595565b91505092915050565b6000608082840312156116605761165f6113de565b5b61166a6080611454565b9050600082013567ffffffffffffffff81111561168a5761168961146f565b5b61169684828501611500565b600083015250602082013567ffffffffffffffff8111156116ba576116b961146f565b5b6116c684828501611500565b60208301525060406116da8482850161154f565b604083015250606082013567ffffffffffffffff8111156116fe576116fd61146f565b5b61170a8482850161161c565b60608301525092915050565b60006020828403121561172c5761172b6113d4565b5b600082013567ffffffffffffffff81111561174a576117496113d9565b5b6117568482850161164a565b91505092915050565b600060408284031215611775576117746113de565b5b61177f6040611454565b9050600082013567ffffffffffffffff81111561179f5761179e61146f565b5b6117ab84828501611500565b600083015250602082013567ffffffffffffffff8111156117cf576117ce61146f565b5b6117db84828501611500565b60208301525092915050565b6000602082840312156117fd576117fc6113d4565b5b600082013567ffffffffffffffff81111561181b5761181a6113d9565b5b6118278482850161175f565b91505092915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561186a57808201518184015260208101905061184f565b83811115611879576000848401525b50505050565b600061188a82611830565b611894818561183b565b93506118a481856020860161184c565b6118ad816113e3565b840191505092915050565b6118c18161152e565b82525050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b60006040830160008301518482036000860152611968828261187f565b91505060208301518482036020860152611982828261187f565b9150508091505092915050565b600061199b838361194b565b905092915050565b6000602082019050919050565b60006119bb8261191f565b6119c5818561192a565b9350836020820285016119d78561193b565b8060005b85811015611a1357848403895281516119f4858261198f565b94506119ff836119a3565b925060208a019950506001810190506119db565b50829750879550505050505092915050565b60006040830160008301518482036000860152611a42828261187f565b91505060208301518482036020860152611a5c82826119b0565b9150508091505092915050565b6000611a758383611a25565b905092915050565b6000602082019050919050565b6000611a95826118f3565b611a9f81856118fe565b935083602082028501611ab18561190f565b8060005b85811015611aed5784840389528151611ace8582611a69565b9450611ad983611a7d565b925060208a01995050600181019050611ab5565b50829750879550505050505092915050565b60006060830160008301518482036000860152611b1c828261187f565b9150506020830151611b3160208601826118b8565b5060408301518482036040860152611b498282611a8a565b9150508091505092915050565b6000611b628383611aff565b905092915050565b6000602082019050919050565b6000611b82826118c7565b611b8c81856118d2565b935083602082028501611b9e856118e3565b8060005b85811015611bda5784840389528151611bbb8582611b56565b9450611bc683611b6a565b925060208a01995050600181019050611ba2565b50829750879550505050505092915050565b60006080830160008301518482036000860152611c09828261187f565b9150506020830151611c1e60208601826118b8565b5060408301518482036040860152611c36828261187f565b91505060608301518482036060860152611c508282611b77565b9150508091505092915050565b60006020820190508181036000830152611c778184611bec565b905092915050565b600067ffffffffffffffff821115611c9a57611c996113f4565b5b602082029050602081019050919050565b600060408284031215611cc157611cc06113de565b5b611ccb6040611454565b9050600082013567ffffffffffffffff811115611ceb57611cea61146f565b5b611cf784828501611500565b600083015250602082013567ffffffffffffffff811115611d1b57611d1a61146f565b5b611d2784828501611500565b60208301525092915050565b6000611d46611d4184611c7f565b611454565b90508083825260208201905060208402830185811115611d6957611d68611590565b5b835b81811015611db057803567ffffffffffffffff811115611d8e57611d8d611474565b5b808601611d9b8982611cab565b85526020850194505050602081019050611d6b565b5050509392505050565b600082601f830112611dcf57611dce611474565b5b8135611ddf848260208601611d33565b91505092915050565b600060808284031215611dfe57611dfd6113de565b5b611e086080611454565b9050600082013567ffffffffffffffff811115611e2857611e2761146f565b5b611e3484828501611500565b600083015250602082013567ffffffffffffffff811115611e5857611e5761146f565b5b611e6484828501611500565b602083015250604082013567ffffffffffffffff811115611e8857611e8761146f565b5b611e9484828501611500565b604083015250606082013567ffffffffffffffff811115611eb857611eb761146f565b5b611ec484828501611dba565b60608301525092915050565b600060208284031215611ee657611ee56113d4565b5b600082013567ffffffffffffffff811115611f0457611f036113d9565b5b611f1084828501611de8565b91505092915050565b60006040830160008301518482036000860152611f36828261187f565b9150506020830151611f4b60208601826118b8565b508091505092915050565b60006020820190508181036000830152611f708184611f19565b905092915050565b600081905092915050565b6000611f8e82611830565b611f988185611f78565b9350611fa881856020860161184c565b80840191505092915050565b6000611fc08284611f83565b915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006120058261152e565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361203757612036611fcb565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061208957607f821691505b60208210810361209c5761209b612042565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026121047fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826120c7565b61210e86836120c7565b95508019841693508086168417925050509392505050565b6000819050919050565b600061214b6121466121418461152e565b612126565b61152e565b9050919050565b6000819050919050565b61216583612130565b61217961217182612152565b8484546120d4565b825550505050565b600090565b61218e612181565b61219981848461215c565b505050565b5b818110156121bd576121b2600082612186565b60018101905061219f565b5050565b601f821115612202576121d3816120a2565b6121dc846120b7565b810160208510156121eb578190505b6121ff6121f7856120b7565b83018261219e565b50505b505050565b600082821c905092915050565b600061222560001984600802612207565b1980831691505092915050565b600061223e8383612214565b9150826002028217905092915050565b61225782611830565b67ffffffffffffffff8111156122705761226f6113f4565b5b61227a8254612071565b6122858282856121c1565b600060209050601f8311600181146122b857600084156122a6578287015190505b6122b08582612232565b865550612318565b601f1984166122c6866120a2565b60005b828110156122ee578489015182556001820191506020850194506020810190506122c9565b8683101561230b5784890151612307601f891682612214565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600061235a8261152e565b91506123658361152e565b92508282101561237857612377611fcb565b5b82820390509291505056fea2646970667358221220d55cff1681fff79a8f1cb250a386087ef1f71d014bd41e56f86d84e27eaf409264736f6c634300080f0033";
        public MarketPlaceDeploymentBase() : base(BYTECODE) { }
        public MarketPlaceDeploymentBase(string byteCode) : base(byteCode) { }

    }

    public partial class AddDataPackFunction : AddDataPackFunctionBase { }

    [Function("addDataPack")]
    public class AddDataPackFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual AddDataPackRequest Request { get; set; }
    }

    public partial class BuyDataFunction : BuyDataFunctionBase { }

    [Function("buyData", typeof(BuyDataOutputDTO))]
    public class BuyDataFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual BuyDataRequest Request { get; set; }
    }

    public partial class CreateOrganizationFunction : CreateOrganizationFunctionBase { }

    [Function("createOrganization")]
    public class CreateOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }

    public partial class GetOrganizationFunction : GetOrganizationFunctionBase { }

    [Function("getOrganization", typeof(GetOrganizationOutputDTO))]
    public class GetOrganizationFunctionBase : FunctionMessage
    {
        [Parameter("tuple", "request", 1)]
        public virtual CreateOrgRequest Request { get; set; }
    }



    public partial class BuyDataOutputDTO : BuyDataOutputDTOBase { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse ReturnValue1 { get; set; }
    }



    public partial class GetOrganizationOutputDTO : GetOrganizationOutputDTOBase { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse ReturnValue1 { get; set; }
    }

    public partial class AddDataPackRequest : AddDataPackRequestBase { }

    public class AddDataPackRequestBase
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse : BuyDataResponseBase { }

    public class BuyDataResponseBase
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual BigInteger Amount { get; set; }
    }

    public partial class BuyDataRequest : BuyDataRequestBase { }

    public class BuyDataRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("string", "organization", 2)]
        public virtual string Organization { get; set; }
        [Parameter("string", "dataPackID", 3)]
        public virtual string DataPackID { get; set; }
        [Parameter("tuple[]", "attributes", 4)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class CreateOrgRequest : CreateOrgRequestBase { }

    public class CreateOrgRequestBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("string", "password", 2)]
        public virtual string Password { get; set; }
    }

    public partial class DataPackReceivedRequest : DataPackReceivedRequestBase { }

    public class DataPackReceivedRequestBase
    {
        [Parameter("string", "userID", 1)]
        public virtual string UserID { get; set; }
        [Parameter("tuple[]", "attributes", 2)]
        public virtual List<Attribute> Attributes { get; set; }
    }

    public partial class DataPackResponse : DataPackResponseBase { }

    public class DataPackResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual BigInteger PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }

    public partial class OrganizationResponse : OrganizationResponseBase { }

    public class OrganizationResponseBase
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual BigInteger Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse> Packs { get; set; }
    }





    public partial class DataPackResponse2 : DataPackResponseBase2 { }

    public class DataPackResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 2)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("tuple[]", "received", 3)]
        public virtual List<DataPackReceivedRequest> Received { get; set; }
    }
    public partial class GetOrganizationOutputDTO2 : GetOrganizationOutputDTOBase2 { }

    [FunctionOutput]
    public class GetOrganizationOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual OrganizationResponse2 ReturnValue1 { get; set; }
    }

    public partial class OrganizationResponse2 : OrganizationResponseBase2 { }

    public class OrganizationResponseBase2
    {
        [Parameter("string", "id", 1)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "balance", 2)]
        public virtual int Balance { get; set; }
        [Parameter("string", "status", 3)]
        public virtual string Status { get; set; }
        [Parameter("tuple[]", "packs", 4)]
        public virtual List<DataPackResponse2> Packs { get; set; }
    }

    public partial class AddDataPackRequest2 : AddDataPackRequestBase2 { }

    public class AddDataPackRequestBase2
    {
        [Parameter("string", "organization", 1)]
        public virtual string Organization { get; set; }
        [Parameter("string", "id", 2)]
        public virtual string Id { get; set; }
        [Parameter("uint256", "pricePerUnit", 3)]
        public virtual int PricePerUnit { get; set; }
        [Parameter("string[]", "requestedAttributes", 4)]
        public virtual List<string> RequestedAttributes { get; set; }
    }

    public partial class BuyDataResponse2 : BuyDataResponseBase2 { }

    public class BuyDataResponseBase2
    {
        [Parameter("string", "status", 1)]
        public virtual string Status { get; set; }
        [Parameter("uint256", "amount", 2)]
        public virtual int Amount { get; set; }
    }
    public partial class BuyDataOutputDTO2 : BuyDataOutputDTOBase2 { }

    [FunctionOutput]
    public class BuyDataOutputDTOBase2 : IFunctionOutputDTO
    {
        [Parameter("tuple", "", 1)]
        public virtual BuyDataResponse2 ReturnValue1 { get; set; }
    }
}

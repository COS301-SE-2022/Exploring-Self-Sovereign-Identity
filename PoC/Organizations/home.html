<!DOCTYPE html>
<html>

<head>
    <title> SSI Marketplace Manager </title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="navBar">
        <h1> Marketplace Manager </h1>
    </div>

    <div class="mainContent">
        <div class="data" id="orgData">

        </div>
        <div class="add" id="newData">
            <div id="newDataInput" style="margin-left: 15%;">
                <label for="inputNewID"> Pack ID </label>
                <input type="text" id="inputNewID" onchange="updatePack()"><br>
                <label for="inputPPU"> Price per Unit </label>
                <input type="text" id="inputPPU" onchange="updatePack()"><br>
                <label for="inputAttr"> Attribute </label>
                <input type="text" id="inputAttr"><br>
                

                <button onclick="addAttr()"> add </button>
                <button onclick="undoAdd()"> undo </button>

                <div class="currentPack">
                    <p id="packID">Organization:  </p>
                    <p id="packPrice">Price per Unit: </p>
                    <p id="allAttrs">Requested data: </p>
                </div>

                <button style="width: 60%;margin-top:10%" onclick="submitToMarketplace()"> Submit to Marketplace </button>
            </div>
        </div>
    </div>

    <script src="js/scripts.js">
    </script>
    <script>
        function fetch() {
            //document.getElementById("orgData").innerHTML

            console.log("fetching...");

            const Http = new XMLHttpRequest();
            const url = 'http://localhost:5000/api/MarketPlace/getOrg';

            Http.open("Post", url);
            Http.setRequestHeader("Content-Type", "application/json");
            Http.send(JSON.stringify({
                "id": localStorage.getItem("username"),
                "password": localStorage.getItem("password")
            }));

            Http.onreadystatechange = (e) => {
                if (Http.readyState == 4 && Http.status == 200) {
                    result = JSON.parse(Http.response);
                    console.log(result);
                    if (result.returnValue1.status == "success") {
                        var size = document.getElementById("orgData").innerHTML = result.returnValue1.packs.length;

                        let el = document.getElementById("orgData");

                        for (let i=0; i<size; i++) {
                            el.innerHTML += result.returnValue1.packs[i].id + "<br>";
                            let ss = result.returnValue1.packs[i].received.length;

                            for (let k=0; k<ss; k++) {
                                el.innerHTML += result.returnValue1.packs[i].received[k].userID + "<br>";
                                let sss = result.returnValue1.packs[i].received[k].attributes.length;

                                for (let n=0; n<sss; n++) {
                                    el.innerHTML += result.returnValue1.packs[i].received[k].attributes[n].name + ": ";
                                    el.innerHTML += result.returnValue1.packs[i].received[k].attributes[n].value + "<br>";
                                }
                            }
                        }
                        //console.log(result);
                    }
                    else {
                        //console.log(result);
                    }
                }
            }
        }

        window.onload = fetch();
    </script>
</body>

</html>